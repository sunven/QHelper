# QHelper 未来路线图 - 需求规格说明

**文档版本：** 1.0
**日期：** 2026-01-28
**状态：** 需求发现完成

---

## 执行摘要

QHelper 是一个面向开发者的 Chrome/Chromium 浏览器扩展，提供各类实用开发工具。本文档基于系统性的需求发现，概述了未来发展规划。

**战略方向：** 从前端专用工具扩展到通用开发者工具，快速增加功能，优先修复 Bug 和统一 UX，同时引入 AI 驱动的模式生成能力。

**目标用户：** 所有开发者（从仅前端开发者扩展）

**主要目标（6-12 个月）：** 快速扩展 - 快速添加大量新工具，与 FeHelper、DevTools 等成熟扩展竞争

---

## 1. 用户需求

### 1.1 目标用户画像

| 用户画像 | 描述 | 核心需求 |
|---------|------|----------|
| **前端开发者** | 使用 HTML/CSS/JS 进行 Web 开发 | JSON 工具、取色器、代码格式化 |
| **后端开发者** | 服务端逻辑、API 开发 | JWT 解码器、哈希生成器、API 测试 |
| **全栈开发者** | 负责整个技术栈 | 以上所有 + 数据格式转换器 |
| **DevOps 工程师** | 基础设施、部署 | Cron 解析器、YAML/TOML 工具、UUID 生成器 |

### 1.2 用户目标

1. **快速访问：** 从浏览器扩展弹窗即时打开工具
2. **无上下文切换：** 无需离开浏览器即可完成任务
3. **隐私优先：** 所有数据保持在本地，无云端依赖
4. **AI 辅助：** 从自然语言生成复杂模式（正则、Cron）
5. **一致的 UX：** 所有工具界面可预测

---

## 2. 功能需求

### 2.1 阶段 1：基础与质量（第 1-4 周）

**优先级：** 关键 - 必须在新功能开发前完成

#### FR-1.1：Bug 修复

| ID | 问题 | 位置 | 验收标准 |
|----|------|------|----------|
| FR-1.1.1 | MD5 编码损坏 | `entrypoints/convert/index.tsx:107-118` | 用可用的实现替换 WebCrypto MD5（crypto-js 或类似库） |
| FR-1.1.2 | JSON diff 未完成 | `entrypoints/json/index.tsx:111-114` | 实现完整的 diff 功能，带视觉对比 |
| FR-1.1.3 | 无错误边界 | 所有工具 | 为每个工具入口点添加 React 错误边界 |

#### FR-1.2：测试框架

| ID | 需求 | 验收标准 |
|----|------|----------|
| FR-1.2.1 | 测试基础设施 | 配置 Vitest + React Testing Library |
| FR-1.2.2 | 组件测试 | 核心 UI 组件（button、input、card）有测试 |
| FR-1.2.3 | 工具测试 | 每个现有工具有基本冒烟测试 |
| FR-1.2.4 | 覆盖率目标 | 关键路径最低 70% 代码覆盖率 |

#### FR-1.3：UX 一致性

| ID | 区域 | 标准 |
|----|------|------|
| FR-1.3.1 | 布局模式 | 所有工具使用一致的卡片布局 |
| FR-1.3.2 | 输入模式 | 标准化的 input/textarea 组件，带验证 |
| FR-1.3.3 | 操作按钮 | 一致的按钮位置（右下角）和标签 |
| FR-1.3.4 | 错误处理 | 统一的错误显示，带清晰操作 |
| FR-1.3.5 | 加载状态 | 所有异步操作显示加载指示器 |

#### FR-1.4：状态持久化

| ID | 需求 | 实现 |
|----|------|------|
| FR-1.4.1 | 工具历史 | JSON 工具历史持久化到 chrome.storage.local |
| FR-1.4.2 | 用户偏好 | 每个工具可保存用户偏好 |
| FR-1.4.3 | 最近使用 | 弹窗显示最近使用的工具 |

### 2.2 阶段 2：安全与加密工具（第 5-8 周）

**优先级：** 高 - 用户要求的类别

| ID | 工具 | 功能 | 依赖 |
|----|------|------|------|
| FR-2.1 | JWT 解码器 | 解码、验证签名、显示声明 | 无外部依赖 |
| FR-2.2 | 哈希生成器 | SHA-1、SHA-256、SHA-512、bcrypt | crypto-js 或类似库 |
| FR-2.3 | 二维码生成器 | 从文本/URL 生成，下载为图片 | qrcode 或 qrcode.react |
| FR-2.4 | 二维码阅读器 | 从图片/文件扫描二维码 | jsQR |
| FR-2.5 | UUID/GUID 工具 | 生成 v4/v5、验证、格式化 | 无外部依赖（使用 crypto.randomUUID） |
| FR-2.6 | 密码生成器 | 可配置长度、字符集、规则 | 无外部依赖 |

### 2.3 阶段 3：Web 格式工具（第 9-12 周）

**优先级：** 高 - 用户要求的类别

| ID | 工具 | 功能 | 依赖 |
|----|------|------|------|
| FR-3.1 | Markdown 编辑器/预览 | 实时预览、导出 HTML、语法高亮 | marked、highlight.js |
| FR-3.2 | HTML 格式化器 | 美化、压缩、格式选项 | js-beautify |
| FR-3.3 | CSS 压缩/美化 | 格式化 CSS、压缩、autoprefixer 选项 | csso、clean-css |
| FR-3.4 | SCSS 编译器 | 编译 SCSS 到 CSS、变量预览 | sass.js |
| FR-3.5 | SVG 优化器 | 删除元数据、压缩、优化路径 | svgo |

### 2.4 阶段 4：数据格式工具（第 13-16 周）

**优先级：** 高 - 用户要求的类别

| ID | 工具 | 功能 | 依赖 |
|----|------|------|------|
| FR-4.1 | Cron 表达式解析器 | 解析、解释、生成下次运行时间 | cron-parser |
| FR-4.2 | YAML 转换器 | YAML ↔ JSON、验证、格式化 | js-yaml |
| FR-4.3 | TOML 解析器 | 解析 TOML、转换为 JSON | toml（或 @iarna/toml） |
| FR-4.4 | JSON Schema 验证器 | 根据验证 JSON | ajv |
| FR-4.5 | XML 格式化器 | 美化、压缩、XML ↔ JSON | fast-xml-parser |

### 2.5 阶段 5：AI 集成（第 17-20 周）

**优先级：** 中 - 差异化功能

**交付模式：** 用户自带密钥（用户提供自己的 API 密钥，本地存储）

| ID | 功能 | 描述 | API 选项 |
|----|------|------|----------|
| FR-5.1 | 正则生成器 | 自然语言 → 正则表达式 | OpenAI、Anthropic 或本地模型 |
| FR-5.2 | Cron 生成器 | 自然语言 → Cron 表达式 | OpenAI、Anthropic 或本地模型 |
| FR-5.3 | JSON Schema 构建器 | 示例 JSON → JSON Schema | OpenAI、Anthropic 或本地模型 |
| FR-5.4 | 模式库 | 常见模式带 AI 解释 | 预构建 + AI 增强 |

**AI 设置需求：**

- FR-5.5：API 密钥管理（添加、删除、验证）
- FR-5.6：提供商选择（OpenAI、Anthropic、自定义端点）
- FR-5.7：模型选择下拉框
- FR-5.8：使用统计跟踪（Token 数量、成本估算）

### 2.6 阶段 6：开发体验（第 21-24 周）

**优先级：** 中 - 体验改进

| ID | 功能 | 描述 |
|----|------|------|
| FR-6.1 | 工具搜索 | 弹窗中的搜索框，按名称/标签查找工具 |
| FR-6.2 | 收藏夹 | 将常用工具固定到弹窗顶部 |
| FR-6.3 | 键盘快捷键 | 常用工具的全局快捷键 |
| FR-6.4 | 自定义主题 | 用户可选颜色主题（超出亮/暗模式） |
| FR-6.5 | 导出/导入设置 | 备份和恢复所有设置和历史 |
| FR-6.6 | 工具组织 | 允许用户创建自定义工具类别 |

---

## 3. 非功能需求

### 3.1 性能

| ID | 需求 | 指标 |
|----|------|------|
| NFR-1.1 | 弹窗加载时间 | < 200ms |
| NFR-1.2 | 工具页面加载 | < 500ms |
| NFR-1.3 | 大文件处理 | 支持最大 10MB 文件 |
| NFR-1.4 | 打包大小 | 每个工具包 < 500KB（gzip 后） |

### 3.2 安全性

| ID | 需求 | 描述 |
|----|------|------|
| NFR-2.1 | 数据本地性 | 所有数据存储在本地 chrome.storage |
| NFR-2.2 | API 密钥存储 | API 密钥加密存储在 chrome.storage.local |
| NFR-2.3 | 无遥测 | 未经明确同意不进行跟踪或分析 |
| NFR-2.4 | 内容安全 | 严格的 CSP 策略，不使用 eval() |
| NFR-2.5 | 权限最小化 | 请求最低所需权限 |

### 3.3 兼容性

| ID | 需求 | 描述 |
|----|------|------|
| NFR-3.1 | Chrome 版本 | 支持 Chrome 88+（Manifest V3） |
| NFR-3.2 | Chromium 浏览器 | 支持 Edge、Brave、Opera（基于 Chromium） |
| NFR-3.3 | 屏幕阅读器 | 基本 ARIA 标签支持可访问性 |

### 3.4 可维护性

| ID | 需求 | 描述 |
|----|------|------|
| NFR-4.1 | TypeScript | 100% TypeScript 覆盖（除构建外无 .js 文件） |
| NFR-4.2 | 组件复用 | 所有工具使用共享组件库 |
| NFR-4.3 | 文档 | 每个工具有 README 说明功能/用法 |
| NFR-4.4 | 代码质量 | Biome 检查通过，无警告 |

---

## 4. 技术架构需求

### 4.1 工具注册系统

**当前问题：** 工具在弹窗数组中硬编码

**需求：** FR-4.1.1 - 声明式工具注册

```typescript
// 必需结构
interface ToolMetadata {
  id: string;
  name: string;
  category: string;
  icon: string;
  description: string;
  entry: string; // index.html 的路径
  keywords: string[];
  tags: string[];
}

// 从 entrypoints 目录自动发现
```

### 4.2 状态管理增强

**需求：** FR-4.2.1 - 一致的状态持久化模式

```typescript
// 所有工具的标准 hook
useToolState<T>(toolId: string, key: string, defaultValue: T)
// 自动持久化到 chrome.storage.local
```

### 4.3 后台工作器增强

**需求：** FR-4.3.1 - 后台工作器职责

- 跨工具消息总线
- 共享缓存层
- AI API 请求处理（对内容脚本隐藏 API 密钥）
- 定时任务（清理、指标）

### 4.4 错误处理

**需求：** FR-4.4.1 - 统一错误边界

```typescript
// 所有工具包装在一致的错误边界中
// 显示错误 UI，带重试/报告选项
```

---

## 5. 数据模型

### 5.1 存储模式

```typescript
// chrome.storage.local 结构
interface QHelperStorage {
  // 工具历史
  histories: {
    [toolId: string]: Array<{
      id: string;
      timestamp: number;
      input: any;
      output: any;
    }>;
  };

  // 每个工具的用户偏好
  preferences: {
    [toolId: string]: {
      [key: string]: any;
    };
  };

  // 全局设置
  settings: {
    theme: 'light' | 'dark' | 'auto';
    favoriteTools: string[];
    recentTools: string[];
    pinnedTools: string[];
    aiProvider?: 'openai' | 'anthropic' | 'custom';
    aiApiKey?: string; // 加密
    aiModel?: string;
  };

  // 使用统计（仅本地）
  stats: {
    toolUsage: {
      [toolId: string]: number;
    };
    lastUpdate: number;
  };
}
```

### 5.2 工具元数据模式

```typescript
interface ToolDefinition {
  id: string;
  name: string;
  nameZh: string; // 中文本地化
  nameEn: string; // 英文本地化
  category: ToolCategory;
  icon: LucideIconName;
  description: string;
  entry: string;
  version: string;
  permissions?: chrome.permissions.Permissions;
  features: string[];
  tags: string[];
}
```

---

## 6. 待确认问题

| ID | 问题 | 影响 | 状态 |
|----|------|------|------|
| OQ-1 | 是否需要添加国际化（i18n）框架？ | 非中文用户必需 | 不考虑 - 仅支持中文用户 |
| OQ-2 | Chrome 网上应用店的目标发布日期？ | 影响时间线和优先级 | 无固定日期 - 按节奏开发 |
| OQ-3 | 是否考虑 Web Bundle 以更快加载工具？ | 性能优化 | 不考虑 - 现有架构已足够 |
| OQ-4 | 是否需要工具市场或自定义工具支持？ | 长期可扩展性 | 不考虑 - 所有工具由项目维护 |
| OQ-5 | AI 功能是否应支持本地模型离线工作？ | AI 可用性和隐私 | 不考虑 - 仅支持在线 API |

---

## 7. 依赖与风险

### 7.1 外部依赖

| 依赖 | 用途 | 风险级别 | 缓解措施 |
|------|------|----------|----------|
| crypto-js | 哈希算法 | 低 - 稳定、广泛使用 | 尽可能使用 Web Crypto API |
| js-beautify | 代码格式化 | 低 - 成熟 | 无需措施 |
| marked | Markdown 解析 | 低 - 稳定 | 无需措施 |
| qrcode.react | 二维码生成 | 低 - 稳定 | 无需措施 |
| AI SDK | OpenAI/Anthropic API | 中 - API 可能变化 | 抽象 API 层，支持多个提供商 |

### 7.2 技术风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| Chrome API 变化 | 中 | 低 | 跟进 Chrome 测试版，使用稳定 API |
| 包大小膨胀 | 高 | 中 | 代码分割、懒加载、审计依赖 |
| AI API 成本 | 中 | 低 | BYOK 模式，用户直接付费 |
| 扩展审核拒绝 | 高 | 低 | 遵循 Chrome 网上应用店政策，无远程代码 |

---

## 8. 成功指标

### 8.1 开发指标

| 指标 | 目标 | 时间线 |
|------|------|--------|
| Bug 修复完成 | 100% 已知 Bug | 阶段 1 |
| 测试覆盖率 | >70% | 阶段 1 |
| 新工具交付 | 20+ 工具 | 6 个月 |
| AI 功能完成 | 3 个 AI 工具 | 阶段 5 |

### 8.2 质量指标

| 指标 | 目标 | 测量方式 |
|------|------|----------|
| TypeScript 覆盖率 | 100% | Biome 检查 |
| Linter 警告 | 0 | Biome lint |
| 严重 Bug | 0 | 用户报告 |
| 可访问性评分 | >90 | Lighthouse 分析 |

---

## 9. 路线图阶段总结

```
阶段 1（第 1-4 周）：  基础与质量
  ├─ Bug 修复（MD5、diff、错误边界）
  ├─ 测试框架
  ├─ UX 一致性标准
  └─ 状态持久化

阶段 2（第 5-8 周）：  安全与加密工具
  ├─ JWT 解码器
  ├─ 哈希生成器
  ├─ 二维码工具
  ├─ UUID/GUID 工具
  └─ 密码生成器

阶段 3（第 9-12 周）： Web 格式工具
  ├─ Markdown 编辑器
  ├─ HTML 格式化器
  ├─ CSS 工具
  ├─ SCSS 编译器
  └─ SVG 优化器

阶段 4（第 13-16 周）：数据格式工具
  ├─ Cron 解析器
  ├─ YAML 转换器
  ├─ TOML 解析器
  ├─ JSON Schema 验证器
  └─ XML 格式化器

阶段 5（第 17-20 周）：AI 集成
  ├─ 正则生成器
  ├─ Cron 生成器
  ├─ JSON Schema 构建器
  └─ AI 设置管理

阶段 6（第 21-24 周）：开发体验
  ├─ 工具搜索
  ├─ 收藏夹
  ├─ 键盘快捷键
  ├─ 自定义主题
  └─ 导出/导入设置
```

---

## 10. 下一步

**重要提示：** 本文档仅包含需求规格说明。

要继续实施，您应该：

1. **审阅本需求规格说明** 并确认与您的愿景一致
2. **解决待确认问题**（第 6 节）再开始实施
3. **使用 `/sc:design`** 创建系统架构和技术设计
4. **使用 `/sc:workflow`** 为每个阶段生成实施计划
5. **使用 `/sc:implement`** 在适当架构到位后开始编码

---

**文档状态：** 准备好审阅和设计阶段

---

## 附录：当前工具清单

| 类别 | 工具 | 状态 | 优先改进 |
|------|------|------|----------|
| 常用 | JSON 格式化器 | ⚠️ 部分 | 添加 diff，修复历史持久化 |
| 常用 | 进制转换器 | ✅ 完成 | 无 |
| 编码转换 | 字符串编解码 | ⚠️ 损坏 | 修复 MD5 实现 |
| 编码转换 | 代码美化 | ✅ 完成 | 无 |
| 编码转换 | Uglify | ✅ 完成 | 无 |
| 图片工具 | 图片 Base64 | ✅ 完成 | 无 |
| 图片工具 | 图片拼接 | ✅ 完成 | 无 |
| 其他 | 时间戳转换 | ✅ 完成 | 无 |
| 其他 | 颜色转换 | ✅ 完成 | 无 |
| 其他 | 清除 Cookie | ✅ 完成 | 无 |

**当前工具总数：** 11
**计划新增工具：** 20+
**目标时间线：** 6 个月
